# generated by makefile_builder.pl using [path cur_dir -t all -t clean -t rootfs msg -t install msg php sh dir]

# search file from current folder to parent folders
# cutoff at 14th parent folder
search_cutoff := ../../../../../../../../../../../../../../
define search-file
	$(if $(filter $(search_cutoff)%,$1),,$(if $(wildcard $1),$1,$(call search-file,../$1)))
endef

include $(call search-file,path.mk)
include $(call search-file,lib.mk)

current_dir := $(shell pwd)
targets :=

############################# section all #############################
targets += all
# file and directory selectors

all:

############################# section install #############################
targets += install
# file and directory selectors
install_php_files := $(wildcard *.php)
install_sh_files := $(wildcard *.sh)
install_directories := $(subst /,,$(shell ls -d */ 2> /dev/null))

install:
	$(call color_print,Install objects in $(current_dir),green)
	$(call install_files,.,$(TARGET)/etc/services,$(install_php_files))
	$(call install_files,.,$(TARGET)/etc/services,$(install_sh_files))
	$(call install_dirs,.,$(TARGET)/etc/services,$(install_directories)) 
	@find $(TARGET)/etc/services -name .svn -type d | xargs rm -rf
ifeq ($(strip $(ELBOX_MINIDLNA)),y)
	cp  UPNPAV_minidlna.php $(TARGET)/etc/services/UPNPAV.php
endif

############################# section rootfs #############################
targets += rootfs
# file and directory selectors

rootfs:
	$(call color_print,Construct install pathes for $(current_dir),green)
	$(call create_install_paths,$(TARGET)/etc/services)

############################# section clean #############################
targets += clean
# file and directory selectors

clean:

.PHONY: $(targets)
